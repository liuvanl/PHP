# 第一章、文件编程的基础
> 在我们的web开发中, 我们会使用到文件上传，下载，创建文件，删除用户，创建目录等等，这时我们就需要使用文件编程.
## 1.1 文件的基本概念
> 数据源，在Php开发中，数据存放的几种形式，数据库/表、内存、文件、第三方接口
## 1.2 文件的输入流和输出流
1. 在php的文件编程中，文件是以字符流或者字节流两种形式来操作. 
2. 输入和输出都是针对php程序(即内存)
3. 读入到php程序【读入内容】， 输入流
4. 从php程序，把内容保存到文件中，输出流.
# 第二章、文件编程
## 2.1 获取文件的信息
### 获取文件的相关信息函数
1. fopen   -----打开文件
2. fstat  ------通过已打开的文件指针取得文件信息
3. flose  -----关闭文件
4. filesize   -----文件大小
5. filectime  -----取得文件创建时间
6. filemtime    -----取得文件修改时间
7. filetype     -----取得文件类型
8. file_exists    -----检查文件或目录是否存在
### 获取文件的方式
#### 第一种
```php
<?php
	header('content-type:text/html;charset=utf8');
	// 获取文件信息
	
	// 1. 定位文件的全路径
	$file_pull_path = './abc.txt';
	// 2. 判断文件是否存在
	if(file_exists($file_pull_path)){
		// 3. 打开文件
		// open函数打开一个文件，获取到文件的指针
		// r 表示以自读的方式打开
		$fp = fopen($file_pull_path,'r');
		// 通过已打开的文件指针取得文件信息
		$fileinfo_arr = fstat($fp);
		
		// 设置时区
		date_default_timezone_set('PRC');
		echo '<br>文件的信息如下：';
		echo '<br>文件的大小：'.$fileinfo_arr['size'];
		echo '<br>文件的访问时间：'.date('Y-m-d H:i:s',$fileinfo_arr['atime']);
		echo '<br>文件的修改时间：'.date('Y-m-d H:i:s',$fileinfo_arr['mtime']);
		echo '<br>文件的创建时间：'.date('Y-m-d H:i:s',$fileinfo_arr['ctime']);
		
	}else {
		echo '该文件不存在！';
	}	
?>
```
#### 第二种
```php
<?php
	header('content-type:text/html;charset=utf8');
	// 1.定义文件的路径
	$file_pull_path = './abc.txt';
	date_default_timezone_set('PRC');
	if(file_exists($file_pull_path)){
		// 直接使用一组函数来获取文件信息，而不需要打开文件
		
		echo '<br>文件的信息如下';
		echo '<br>文件的大小'.filesize($file_pull_path);
		echo '<br>文件的访问时间：'.date('Y-m-d H:i:s',fileatime($file_pull_path));
		echo '<br>文件的修改时间：'.date('Y-m-d H:i:s',filemtime($file_pull_path));
		echo '<br>文件的创建时间：'.date('Y-m-d H:i:s',filectime($file_pull_path));
		
	}else {
		echo '当前文件不存在';
	}
?>
```
## 2.2 读取文件的内容，并显示在网页
### 读取文件的相关函数
1. fread   ------读取文件（可安全用于二进制文件）
2. file_get_contents   ----- 将整个文件读入一个字符串
3. feof     -------测试文件指针是否到了文件结束的位置
4. str_replace    ------子字符串替换
5. parse_ini_file     -------解析一个配置文件
### 基本使用案例
#### 读取文件的内容并显示在网页（三种方式）
+ 第一种
```php
<?php
	header('content-type:text/html;charset=utf8');
	// 1. 定义文件的路径
	$file_pull_path = './abc.txt';
	// 判断
	if(file_exists($file_pull_path)){
		// 2. 打开文件
		$fp = fopen($file_pull_path,'r');
		// 3. 获取文件的大小
		$file_size = filesize($file_pull_path);
		// 4. 读取内容
		/**
			fread 读取一个文件的内容
			@param stream $fp  表示文件指针
			@param int $file_size   表示从$fp读取多少字节
		*/
		$con_str = fread($fp,$file_size);		
		// 及时关闭文件  这一步至关重要
		fclose($fp);		
		// windows系统下，文件中换行是\r\n
		// linux系统下,文件中换行是\n
		// 在网页中，换行是<br>
		// 处理兼容性
		$con_str = str_replace("\r\n","<br>",$con_str) ? str_replace("\r\n","<br>",$con_str) : str_replace("\n","<br>",$con_str);
		$con_str = str_replace("	",'&nbsp;&nbsp;',$con_str);
		// 显示在网页上
		echo $con_str;		
	}else {
		echo '<br>文件不存在';
	}	
?>
```
> 上面方式的分析: 我们是一次性的将内容读入到内存，这样处理大文件不是很好，因此这样我们可以使用第二种读取文件的方式.(可以设置缓冲)
+ 第二种
```php
<?php
	header('content-type:text/html;charset=utf8');
	// 1. 定义文件的路径
	$file_pull_path = './abc.txt';
	if(file_exists($file_pull_path)){
		// 2. 打开文件
		$fp = fopen($file_pull_path,'r');
		// 3. 设置缓冲
		$buffer = '';
		$buffer_size = 1024;		// 缓冲的字节
		$con_str = '';
		// 开始第一次读取$buffer_size,循环读取
		// !feof如果没有找到文件，就继续读取
		while(!feof($fp)){
			$buffer = fread($fp,$buffer_size);			
			$con_str .= $buffer;
		}
		fclose($fp);
		// 替换换行
		$con_str = str_replace("\r\n","<br>",$con_str) ? str_replace("\r\n","<br>",$con_str) : str_replace("\n","<br>",$con_str);
		$con_str = str_replace("	","&nbsp;&nbsp;",$con_str);
		
		echo $con_str;
	}else {
		echo '文件不存在';
	}
?>
```
+ 第三种
> 第三种方式最简洁，使用的是最多的. file_get_contents  file_put_contents()
```php
<?php
	header('content-type:text/html;charset=utf8');
	// 1. 定义文件的路径
	$file_pull_path = './abc.txt';
	if(file_exists($file_pull_path)){
		// file_get_contents做了一个封装，底层仍然是fopen fread
		$con_str = file_get_contents($file_pull_path);
		// 替换换行
		$con_str = str_replace("\r\n","<br>",$con_str) ? str_replace("\r\n","<br>",$con_str) : str_replace("\n","<br>",$con_str);
		$con_str = str_replace("	","&nbsp;&nbsp;",$con_str);		
		echo $con_str;
		
	}else {
		echo '文件不存在';
	}	
?>
```
+ 小结:在实际开发中如何选择方式
1. 如果我们处理的文件很大(100m)，建议使用第二种
2. 如果是普通的文件，没有特殊的要求，建议使用第三种.
#### 读取配置文件 config.ini
```php
<?php
	header('content-type:text/html;charset=utf8');
	// 1. 定义文件的路径
	$file_pull_path = './ts.ini';
	if(file_exists($file_pull_path)){		
		$arr_ini = parse_ini_file($file_pull_path);
		var_dump($arr_ini);
		
		echo '<br>名字是：'.$arr_ini['name'];
		echo '<br>名字是：'.$arr_ini['age'];
		echo '<br>名字是：'.$arr_ini['sex'];
	}else {
		echo '文件不存在';
	}	
?>
```
